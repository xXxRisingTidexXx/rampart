shell: bash
commands:
  build:
    description: Construct/renovate all local docker images
    cmd: docker-compose build checks backend notebook
  database:
    description: Run the DB server
    cmd: docker-compose up -d database
  psql:
    description: Run PostgreSQL CLI
    cmd: docker exec -it rampart-database psql rampart postgres
  generate:
    description: Generate a new SQL migration file
    cmd: |
      mkdir -p internal/migrations/versions && \
      VERSION=$(date +"%s") && \
      touch internal/migrations/versions/$VERSION.sql && \
      sleep 1
  migrations:
    description: Upgrade the DB schema to the newest version
    cmd: docker-compose run --rm migrations
  mining:
    description: Run the data mining app single workflow
    cmd: docker-compose run --rm mining
  gauging:
    description: Up Overpass API client & distance measurer
    cmd: |
      docker-compose up gauging
      docker rm rampart-gauging || true
  run:
    description: Activate the whole rampart ecosystem
    cmd: |
      docker-compose up gauging mining-domria-primary mining-domria-secondary
      docker rm rampart-mining-domria-primary rampart-mining-domria-secondary rampart-gauging || true
  stop:
    description: Dispose all docker stuff
    cmd: docker-compose down
  format:
    description: Format the source code
    cmd: docker-compose run --rm gofmt
  lint:
    description: Lint the source code
    cmd: docker-compose run --rm lint
  test:
    description: Run test suites
    cmd: docker-compose run --rm test
  jupyter:
    description: Run Jupyter Lab server
    cmd: |
      docker-compose up jupyter
      docker rm rampart-jupyter || true
