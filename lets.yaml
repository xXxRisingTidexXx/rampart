shell: bash
commands:
  build:
    description: Construct/renovate all local docker images
    cmd: docker-compose build aggregation gochecks notebook ranking recognition pychecks
  database:
    description: Run the DB server
    cmd: docker-compose up -d database
  psql:
    description: Run PostgreSQL CLI
    cmd: docker exec -it rampart-database psql rampart postgres
  migrate:
    description: Upgrade the DB schema to the newest version
    cmd: |
      docker-compose up migrate
      docker rm rampart-migrate
  generate:
    description: Create the brand new migration files
    cmd: |
      printf 'Enter new migration name: ' && \
      read RAMPART_MIGRATION_NAME && \
      docker-compose up generate create -ext sql -dir /migrations $RAMPART_MIGRATION_NAME && \
      docker rm rampart-generate
      sudo chown -R $USER:$USER migrations
  mining:
    description: Run the data mining app single workflow
    cmd: |
      docker-compose up mining
      docker rm rampart-mining
  imaging:
    description: Run the image downloader
    cmd: |
      docker-compose up imaging
      docker rm rampart-imaging
  lint:
    description: Lint the source code
    cmd: |
      docker-compose up lint
      docker rm rampart-lint
  test:
    description: Run test suites
    cmd: docker-compose run --rm test
  notebook:
    description: Run Jupyter Lab server
    cmd: |
      docker-compose up notebook
      docker rm rampart-notebook
  telebot:
    description: Run telegram bot module
    cmd: |
      docker-compose up telebot
      docker rm rampart-telebot
  browsing:
    description: Run search engine debug frontend
    cmd: |
      docker-compose up browsing
      docker rm rampart-browsing
  flake8:
    description: Run python code linter
    cmd: |
      docker-compose up flake8
      docker rm rampart-flake8
  mypy:
    description: Run python type checker
    cmd: |
      docker-compose up mypy
      docker rm rampart-mypy
  pytest:
    description: Run python test suites
    cmd: |
      docker-compose up pytest
      docker rm rampart-pytest
  run:
    description: Activate the whole rampart ecosystem
    cmd: |
      docker-compose up mining-domria-primary mining-domria-secondary
      docker rm rampart-mining-domria-primary rampart-mining-domria-secondary
  stop:
    description: Dispose all docker stuff
    cmd: docker-compose down
