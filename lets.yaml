shell: bash
commands:
  build:
    description: Construct/renovate all local docker images
    cmd: |
      mkdir -p .cache .config .ipython .jupyter .local .npm && \
      if [[ ! -e .env ]]; then touch .env ; fi && \
      mkdir -p scientific scientific/images scientific/models scientific/tables && \
      if [[ ! -e scientific/images.csv ]]; then touch scientific/images.csv ; fi && \
      docker-compose build golang notebook python
  database:
    description: Run the DB server
    cmd: docker-compose up -d database
  psql:
    description: Run PostgreSQL CLI
    cmd: docker exec -it rampart-database psql rampart postgres
  migrate:
    description: Upgrade the DB schema to the newest version
    cmd: docker-compose run --rm migrate
  generate:
    description: Create the brand new migration files
    cmd: |
      printf 'Enter new migration name: ' && \
      read MIGRATION && \
      docker-compose run --rm generate create -ext sql -dir /migrations $MIGRATION && \
      sudo chown -R $USER:$USER migrations
  messis:
    description: Launch flat mining application
    cmd: |
      docker-compose up messis
      docker rm rampart-messis
  miner:
    description: Run the data mining app single workflow
    cmd: docker-compose run --rm miner
  warhol:
    description: Start the image downloader
    cmd: |
      rm -rf scientific/images && \
      mkdir scientific/images && \
      START=`date +%s` && \
      docker-compose run --rm warhol && \
      END=`date +%s` && \
      sudo chown -R $USER:$USER scientific && \
      echo "Total images: $(ls scientific/images | wc -l)" && \
      echo "Total size: $(du -hs scientific/images | cut -f1)" && \
      echo "Total time: $((END - START))s"
  travesty:
    description: Run image augmentation demo
    cmd: |
      rm -f images/target_*.webp && \
      docker-compose run --rm travesty && \
      sudo chown -R $USER:$USER images
  assistant:
    description: Run Telegram API client in long pulling mode + flat snitch
    cmd: |
      docker-compose up assistant
      docker rm rampart-assistant
  publisher:
    description: Launch apartment issuer code
    cmd: docker-compose run --rm publisher
  moderator:
    description: Run data moderation & markup bot
    cmd: |
      docker-compose up moderator
      docker rm rampart-moderator
  notebook:
    description: Setup Jupyter Notebook server
    cmd: |
      docker-compose up notebook
      docker rm rampart-notebook
      chown -R $USER:$USER scientific
  auge:
    description: Run image classification task
    cmd: docker-compose run --rm auge-debug
  twinkle:
    description: Perform ranking by subscriptions
    cmd: docker-compose run --rm twinkle-debug
  coquus:
    description: Execute ranking dataset augmentation
    cmd: docker-compose run --rm coquus && sudo chown -R $USER:$USER scientific
  run:
    description: Activate the whole rampart ecosystem
    cmd: |
      docker-compose up messis assistant twinkle auge
      docker rm rampart-messis rampart-assistant rampart-twinkle rampart-auge
  stop:
    description: Dispose all docker stuff
    cmd: docker-compose down
