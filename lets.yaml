shell: bash
commands:
  compile:
    description: Compile the source code
    cmd: |
      rm -f mining
      go build -o mining cmd/mining/main.go
      rm -f migrations
      go build -o migrations cmd/migrations/main.go
  race:
    description: Check the source code for race conditions
    cmd: |
      rm -f mining-race
      go build -race -o mining-race cmd/mining/main.go
      rm -f migrations-race
      go build -race -o migrations-race cmd/migrations/main.go
  mining:
    description: Run the data mining app
    cmd: ./mining
  generate:
    description: Generate a new SQL migration file
    cmd: mkdir -p internal/migrations/versions && touch internal/migrations/versions/$(date +"%s").sql && sleep 1
  upgrade:
    description: Upgrade the DB schema to the newest version
    cmd: ./migrations upgrade
  psql:
    description: Run PostgreSQL CLI
    depends:
      - database
    cmd: |
      sleep 2
      docker exec -it database psql rampart postgres
      lets stop
  database:
    description: Run the DB server
    cmd: docker-compose up -d database
  stop:
    description: Dispose all docker stuff
    cmd: docker-compose down
  format:
    description: Format the source code
    cmd: gofmt -w -s .
  lint:
    description: Lint the source code
    cmd: golangci-lint run
  test:
    description: Run test suites
    cmd: go test -v rampart/internal/mining/domria
  benchmark:
    description: Run benchmarking
    cmd: go test -bench=. -benchmem
